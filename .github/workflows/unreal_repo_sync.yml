name: sync unreal repo

on: 
  workflow_dispatch:

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0 

    - name: Filter directory
      run: |
        sudo apt install git-filter-repo
        git filter-repo --path unreal/Puerts/ --force
        git remote add target-repo https://github.com/puerts/Puerts.git
        git fetch target-repo master --depth=1  # 获取目标仓库基础分支

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v5
      with:
        token: ${{ secrets.PAT }}
        base: master
        repository: puerts/Puerts
        branch: sync-${GITHUB_SHA:0:7} 
        path: .
        commit-message: "Sync Puerts changes"
        title: "Sync from upstream repository"
      env:
        GITHUB_TOKEN: ${{ secrets.PAT }}